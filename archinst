#!/usr/bin/env bash

# Arch Linux Fast Install 
# --------------------------------
# author    : Virus_Man
#             
# project   ээ: ArchInst
#             
# license   : LGPL-3.0 (http://opensource.org/licenses/lgpl-3.0.html)
#
# reference : https://wiki.archlinux.org/index.php/Installation_guide

apptitle="Arch Linux Fast Install (archinst) - Version: 2024.02.14.00.00.01 (GPLv3)"
baseurl=https://raw.githubusercontent.com/vt71ru/arch_Install/main/archinst

yourdrive=""
toolchoice=""
rootpart=""
bootpart=""

hostname=""
timezone=""

# COLORS
red=$(tput setaf 1)
white=$(tput setaf 7)
green=$(tput setaf 2)
yellow=$(tput setaf 3)

logo () {
# This will be shown on every set as user is progressing
echo -ne "
__________________________________________________________________________________________________________
|                                                                                                         |
|                                                                                                         |
| █████  ██████   ██████ ██   ██     ██ ███    ██ ███████ ████████  █████  ██      ██      ███████ ██████ |
|██   ██ ██   ██ ██      ██   ██     ██ ████   ██ ██         ██    ██   ██ ██      ██      ██      ██   ██|
|███████ ██████  ██      ███████     ██ ██ ██  ██ ███████    ██    ███████ ██      ██      █████   ██████ |
|██   ██ ██   ██ ██      ██   ██     ██ ██  ██ ██      ██    ██    ██   ██ ██      ██      ██      ██   ██|
|██   ██ ██   ██  ██████ ██   ██     ██ ██   ████ ███████    ██    ██   ██ ███████ ███████ ███████ ██   ██|
|                                                                                                         |
|---------------------------------------------------------------------------------------------------------|
|                Install arch linux in few clicks. Even a 5 year kid can install arch now.                |
|---------------------------------------------------------------------------------------------------------|
|                               Base Installation Of Arch Linux Begins Now                                |
|       Check: https://github.com/vt71ru/arch_install/ To Know More Details About This Installation       |
|---------------------------------------------------------------------------------------------------------|
|_________________________________________________________________________________________________________|

"
}

chose_lang () {
echo "Please select languale for installiation system"
select lang in English Russian Quit;
do
  case $lang in
  "English")
     
     ;;
  "Russian")
     source  ./lang/russian
     choose_lang
     ;;
  "Quit")
     break
     ;;
  esac
done
}

#wificonn () {
#echo  -e "Check internet connection"........
#up=`ping -c 1 -q raw.githubusercontent.com`
#case $? in
#0) echo -en "+ \033[32;1;49mInternet is available \033[0m\n"
#  echo -e "Connection aviable..."
#	;;
#*) echo -en "- \033[31;1;49mWarning! \033[0m\033[31;1;5mInternet not available \033[0m\n"
#select conntype in Cable Wireless
#do
#  case $conntype in
#  "Cable")
#     echo "I also use $conntype connection. Check cable connection"
#     ;;
#  "Wifi")
#     iwctl --passphrase passphrase station device connect SSID
#     ;;
#  esac
#done
#esac
#}

sys_info () {
 #while-menu-dialog: a menu driven system information program

DIALOG_CANCEL=1
DIALOG_ESC=255
HEIGHT=0
WIDTH=0

display_result() {
  dialog --title "$1" \
    --no-collapse \
    --msgbox "$result" 0 0
}

while true; do
  exec 3>&1
  selection=$(dialog \
    --backtitle "System Information" \
    --title "Menu" \
    --clear \
    --cancel-label "Exit" \
    --menu "Please select:" $HEIGHT $WIDTH 4 \
    "1" "Display System Information" \
    "2" "Display Disk Space" \
    "3" "Display Home Space Utilization" \
    2>&1 1>&3)
  exit_status=$?
  exec 3>&-
  case $exit_status in
    $DIALOG_CANCEL)
      clear
      echo "Program terminated."
      exit
      ;;
    $DIALOG_ESC)
      clear
      echo "Program aborted." >&2
      exit 1
      ;;
  esac
  case $selection in
    1 )
      result=$(echo "Hostname: $HOSTNAME"; uptime)
      display_result "System Information"
      ;;
    2 )
      result=$(lsblk |grep -v "loop*" |grep -v "arch_root*")
      display_result "Disk Space"
      ;;
    3 )
      if [[ $(id -u) -eq 0 ]]; then
        result=$(du -sh /home/* 2> /dev/null)
        display_result "Home Space Utilization (All Users)"
      else
        result=$(du -sh $HOME 2> /dev/null)
        display_result "Home Space Utilization ($USER)"
      fi
      ;;
  esac
done
}

disk () {
              printf " \033[1m ${red} msg1 \n \033[0m"
	      lsblk |grep -v "loop*" |grep -v "arch_root*"
	      printf " \033[1m \n ${white} $msg2:${red} i.e. ${white}/dev/sda \n \033[0m "
	      #printf " \033[1m ${red} WARNING:${green} /dev/sda ${white}may not be empty on your system\n \033[0m "
	      printf " \033[1m \n ${yellow} $msg4 ${white}\033[0m "
	      read yourdrive
	      echo $yourdrive
	      printf " \033[1m ${white} \n $msg5 ${green} cfdisk ${white} $msg7 ${green} fdisk ? \n \033[0m"
	      printf " \033[1m \n ${yellow} $msg6 ${white}\033[0m"
	      read toolchoice
	      if [ "$toolchoice" == cfdisk -o "$toolchoice" == CFDISK ]
		    then
		    cfdisk $yourdrive
	      else
		    fdisk $yourdrive
	      fi
}

genfstab (){
echo "generating fstab file"
genfstab -U /mnt >> /mnt/etc/fstab
sleep 2s
clear
}

logo
chose_lang
sys_info
disk
#genfstab
clear
